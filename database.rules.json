{
  "rules": {
    "members": {
      "$member_uid": {
        ".read": "auth != null",

        // Only the member is able to update his/her profile
        ".write": "auth != null && auth.uid == $member_uid"
      },

      // List of members
      ".read": "auth != null"
    },

    "prayers": {
      "$prayer_id": {
        "views": {
          ".write": "auth != null"
        },

        "comments": {
          "$comments_id": {
            // New comment: any authenticated users
            // Delete a comment: only the owner
            ".write": "auth != null && (!data.exists() || (data.exists() && data.child('createdBy').val() == auth.uid))",

            ".validate": "newData.hasChildren(['content', 'createdBy', 'createdAt']) && newData.child('createdBy').val() == auth.uid"
          }
        },

        // New prayer: any authenticated users
        // Delete / Edit a prayer: only the owner
        ".write": "auth != null && (!data.exists() || (data.exists() && data.child('poster').val() == auth.uid))"
      },

      // List of prayers
      ".read": "auth != null"
    },

    "membersPrayingForPrayerRequests": {
      ".read": "auth != null",

      "$prayer_id": {
        "$uid": {
          // Must be a boolean
          ".validate": "
          	newData.isBoolean()",

          // - Must be the owner
          // - Must correspond to an existing prayer
          ".write": "
          	auth != null &&
              $uid == auth.uid &&
              root.child('prayers').hasChild($prayer_id)"
        }
      }
    }
  }
}
